### Day 10: Cross-cutting Patterns Testing

### Variables
@baseUrl = http://localhost:3000
@token = YOUR_TOKEN_HERE

### 1. Login to get token
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@acme.com",
  "password": "Password123!"
}

### 2. Test timing header - check X-Response-Time in response headers
GET {{baseUrl}}/events
Authorization: Bearer {{token}}

### 3. Test validation errors - structured error response
POST {{baseUrl}}/events
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "",
  "description": "x",
  "startDate": "invalid-date",
  "endDate": "2026-03-01T10:00:00Z"
}

### 4. Test query validation - invalid page number
GET {{baseUrl}}/events?page=0&limit=5
Authorization: Bearer {{token}}

### 5. Test query validation - invalid limit (too high)
GET {{baseUrl}}/events?page=1&limit=101
Authorization: Bearer {{token}}

### 6. Test query validation - invalid sort field
GET {{baseUrl}}/events?sortBy=invalidField
Authorization: Bearer {{token}}

### 7. Test query validation - invalid date format
GET {{baseUrl}}/events?startDateFrom=not-a-date
Authorization: Bearer {{token}}

### 8. Test successful request with timing
GET {{baseUrl}}/events?page=1&limit=10&sortBy=startDate&sortOrder=asc
Authorization: Bearer {{token}}

### 9. Test health endpoint (should have timing header)
GET {{baseUrl}}/health

### 10. Test unauthorized request (401)
GET {{baseUrl}}/events

### 11. Test forbidden request (403) - user accessing admin route
# First login as regular user
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "user@acme.com",
  "password": "Password123!"
}

### 12. Test with user token (should get 403 on some routes)
GET {{baseUrl}}/events
Authorization: Bearer USER_TOKEN_HERE

### 13. Test request ID in error response
POST {{baseUrl}}/events
Authorization: Bearer {{token}}
Content-Type: application/json
x-request-id: test-request-123

{
  "title": ""
}

### 14. Test nested validation errors
POST {{baseUrl}}/auth/signup
Content-Type: application/json

{
  "email": "invalid-email",
  "password": "123",
  "firstName": "",
  "lastName": "",
  "organizationId": "not-a-uuid"
}

### 15. Test response envelope (if ENABLE_ENVELOPE=true)
# Set ENABLE_ENVELOPE=true in .env and restart app
GET {{baseUrl}}/events?page=1&limit=5
Authorization: Bearer {{token}}

### 16. Test multiple validation errors
POST {{baseUrl}}/events
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "ab",
  "description": "x",
  "startDate": "2026-03-15T10:00:00Z",
  "endDate": "2026-03-14T10:00:00Z"
}

### 17. Check timing on slow endpoint
GET {{baseUrl}}/events?page=1&limit=100
Authorization: Bearer {{token}}

### 18. Test CORS headers
OPTIONS {{baseUrl}}/events
Origin: http://localhost:4200

### 19. Test error response format consistency
GET {{baseUrl}}/events/invalid-uuid
Authorization: Bearer {{token}}

### 20. Test success response format
GET {{baseUrl}}/health/live
